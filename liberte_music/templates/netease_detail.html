<html>
<head>
	<meta charset="UTF-8">
	<title>LiBerte Music</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/style.css">
	<script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
	<script src="{{STATIC_URL}}js/bootstrap.min.js"></script>
	<script type="text/javascript">
	function playall(){
		//var netease_str = document.getElementById("taste_netease").value;
		var detail_str = document.getElementById("detail").value;
		
		if(detail_str!="")
		{
			
			var detail = JSON.parse( detail_str );
			var length = detail.length ;
			var ul = window.parent.document.getElementById("playlist");

			if(window.parent.playlist[0]["title"] == "-")
			{
				window.parent.playlist.shift();
				var li = ul.childNodes[0];
				ul.removeChild(li);
			}
			var length_playlist = window.parent.playlist.length;
			for (var i = 0; i < length; i++) {
				
				song = {
					title: detail[i]["name"],
					title_url: "http://music.163.com/song?id="+detail[i]["id"],
					artist: detail[i]["artist_name"],
					album: detail[i]["album_name"],
					cover:detail[i]["cover"],
					mp3: detail[i]["mp3Url"],
					ogg: ''
				};
				window.parent.playlist.push(song);
				localStorage.setItem("playlist",JSON.stringify(window.parent.playlist));
				var li = document.createElement('li');
				li.textContent = song.artist+' - '+song.title;
				ul.appendChild(li);
				localStorage.setItem("playlist_ul",ul.parentNode.innerHTML);
			}
			window.parent.switchTrack(length_playlist);
		}
	}
	function playsong(id,name,artist,album,cover,mp3Url){
		//console.log(mp3Url);
		//console.log(cover);
		song = {
			title: name,
			title_url:"http://music.163.com/song?id="+id,
			artist: artist,
			album: album,
			cover:cover,
			mp3: mp3Url,
			ogg: ''
		};
		var ul = window.parent.document.getElementById("playlist");
		if(window.parent.playlist[0]["title"] == "-")
		{
			window.parent.playlist.shift();
			var li = ul.childNodes[0];
			ul.removeChild(li);
		}
		var length_playlist = window.parent.playlist.length;
		window.parent.playlist.push(song);
		localStorage.setItem("playlist",JSON.stringify(window.parent.playlist));
		var li = document.createElement('li');
		li.textContent = song.artist+' - '+song.title;
		ul.appendChild(li);
		localStorage.setItem("playlist_ul",ul.parentNode.innerHTML);
		window.parent.switchTrack(length_playlist);
	}
	</script>
</head>
<body>
	{% include 'nav.html' %} 

<div class="container">
	
	<br/>
	<div>
	{%  if profile.detail  %}
	
	<input type="hidden" id="detail" value="{{profile.detail_str}}">
	<button type="button" class="btn btn-danger btn-sm" style="float:left;" onclick="playall()">
  		播放全部
	</button>
	
	<br/>
	<hr/>
	<table class="table">
	<tr>
		<th>#Play</th>
		<th>歌曲</th>
		<th>时长</th>
		<th>歌手</th>
		<th>专辑</th>
	</tr>
	{% for song in profile.detail %}
	
	<tr>
	<td>
	<button type="button" class="btn btn-default btn-sm" onclick="playsong('{{song.id}}','{{song.name}}','{{song.artist_name}}','{{song.album_name}}','{{song.cover}}','{{song.mp3Url}}')">
  		<span class="glyphicon glyphicon-music" aria-hidden="true"></span>
	</button>
	</td><td>
	<a  href="http://music.163.com/song?id={{song.id}}" target="_blank">{{song.name}}</a>
	</td>
	<td>{{song.duration}}</td>
	<td><a target="_blank" href="http://music.163.com/artist?id={{song.artist_id}}">{{song.artist_name}}</a></td>
	<td><a target="_blank" href="http://music.163.com/album?id={{song.album_id}}">{{song.album_name}}</a></td>
	</tr>
	{% endfor %}

	</table>
	<br/>
	
	{% endif %}
	</div>
	<br/>
<div style="height: 150;"></div>
</div>
<script src="{{STATIC_URL}}js/iframe.js"></script>
</body>
</html>